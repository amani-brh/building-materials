@using building_materials.Models.DTOs
@model IEnumerable<MaterialDTO>


<!-- About Start -->
<section id="about" class="container-xxl py-5">
    <div class="container">
        <div class="row g-5">
            <div class="col-lg-6 wow fadeIn" data-wow-delay="0.1s">
                <div class="d-flex flex-column">
                    <img class="img-fluid rounded w-75 align-self-end" src="img/about-1.jpg" alt="About Image 1">
                    <img class="img-fluid rounded w-50 bg-white pt-3 pe-3" src="img/about-2.jpg" alt="About Image 2" style="margin-top: -25%;">
                </div>
            </div>
            <div class="col-lg-6 wow fadeIn" data-wow-delay="0.5s">
                <p class="d-inline-block border rounded-pill py-1 px-4">About the Founder</p>
                <h1 class="mb-4">Meet Amani Barhoumi — The Vision Behind This Platform</h1>
                <p>This platform was developed by <strong>Amani Barhoumi</strong>, a passionate and dedicated second-year Civil Engineering student at <strong>ENIT (École Nationale d'Ingénieurs de Tunis)</strong>.</p>
                <p class="mb-4">It was created as part of her <strong>Projet de Fin d'Année (PFA)</strong>, under the guidance and supervision of <strong>Dr. Jelidi Ahmed</strong>. The goal of the platform is to contribute meaningfully to sustainable building practices by providing accessible and transparent environmental data on building materials.</p>
                <p><i class="far fa-check-circle text-primary me-3"></i>Driven by passion for civil engineering</p>
                <p><i class="far fa-check-circle text-primary me-3"></i>Focus on sustainable materials</p>
                <p><i class="far fa-check-circle text-primary me-3"></i>Created with academic and environmental purpose</p>
            </div>
        </div>
    </div>
</section>
<!-- About End -->



<!-- Service Start -->
<div id="service" class="container-xxl py-5">
    <div class="container">
        <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 600px;">
            <p class="d-inline-block border rounded-pill py-1 px-4">Services</p>
            <h1>Explore Our Services</h1>
        </div>
        <div class="row g-4">
            <!-- Transport Factors -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-truck-loading text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Transport Factors</h4>
                    <p class="mb-4">Define and manage the environmental impact factors associated with different transport types.</p>
                    @Html.ActionLink("View More", "Index", "FacteurTransport", new { }, new { @class = "btn btn-light rounded-pill px-4 py-4" })
                </div>
            </div>

            <!-- Materials -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.2s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-clipboard-list text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Materials</h4>
                    <p class="mb-4">Browse and maintain the database of construction materials used in civil engineering projects.</p>
                    @Html.ActionLink("View More", "Index", "Materiau", new { }, new { @class = "btn btn-light rounded-pill px-4 py-2" })
                </div>
            </div>

            <!-- Material Families -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.3s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-sitemap text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Material Families</h4>
                    <p class="mb-4">Organize materials into families for better classification and lifecycle impact tracking.</p>
                    @Html.ActionLink("View More", "Index", "Famille", new { }, new { @class = "btn btn-light rounded-pill px-4 py-2" })
                </div>
            </div>

            <!-- Provenances -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.4s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-globe-americas text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Provenances</h4>
                    <p class="mb-4">Track the origin locations of materials to evaluate transportation and environmental impact.</p>
                    @Html.ActionLink("View More", "Index", "Provenance", new { }, new { @class = "btn btn-light rounded-pill px-4 py-2" })
                </div>
            </div>

            <!-- Producers -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.5s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-hard-hat text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Producers</h4>
                    <p class="mb-4">Maintain a database of manufacturers and suppliers involved in material production.</p>
                    @Html.ActionLink("View More", "Index", "Producteur", new { }, new { @class = "btn btn-light rounded-pill px-4 py-2" })
                </div>
            </div>

            <!-- Transports -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.6s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-truck-moving text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Transports</h4>
                    <p class="mb-4">Manage the means of transportation used across material supply chains.</p>
                    @Html.ActionLink("View More", "Index", "Transport", new { }, new { @class = "btn btn-light rounded-pill px-4 py-2" })
                </div>
            </div>

            <!-- Environmental Characteristics -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.7s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-seedling text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Environmental Characteristics</h4>
                    <p class="mb-4">Assess environmental attributes and sustainability scores related to each material.</p>
                    @Html.ActionLink("View More", "Index", "CaracteristiqueEnvironnementale", new { }, new { @class = "btn btn-light rounded-pill px-4 py-2" })
                </div>
            </div>

            <!-- Material Types -->
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.8s">
                <div class="service-item bg-light rounded h-100 p-5">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle mb-4" style="width: 65px; height: 65px;">
                        <i class="fa fa-hammer text-primary fs-4"></i>
                    </div>
                    <h4 class="mb-3">Material Types</h4>
                    <p class="mb-4">Categorize materials by type for structured data handling and carbon analysis.</p>
                    @Html.ActionLink("View More", "Index", "MaterialType", new { }, new { @class = "btn btn-light rounded-pill px-4 py-2" })
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Service End -->


    <div class="container mt-4">
        <h1 class="mb-4">Matériaux de Construction</h1>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="Rechercher par nom...">
                    <div class="input-group-append">
                        <button class="btn btn-primary" id="searchButton" type="button">Rechercher</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 text-right">
                <button class="btn btn-warning" id="compareButton" disabled>Comparer les Matériaux Sélectionnés</button>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Liste des Matériaux</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="materialsTable">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAll" /></th>
                                        <th>Nom</th>
                                        <th>Origine</th>
                                        <th>Famille</th>
                                        <th>Type</th>
                                        <th>Pays</th>
                                        <th>Émission CO2</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Material Details Modal -->
    <div class="modal fade" id="materialModal" tabindex="-1" role="dialog" aria-labelledby="materialModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="materialModalLabel">Détails du Matériau</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="materialModalBody">
                    <!-- Material details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="viewStatsBtn">Voir les Statistiques</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div class="modal fade" id="statsModal" tabindex="-1" role="dialog" aria-labelledby="statsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="statsModalLabel">Statistiques du Matériau</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <canvas id="emissionsChart"></canvas>
                        </div>
                        <div class="col-md-6">
                            <canvas id="pollutionChart"></canvas>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-12">
                            <div id="statsDetails">
                                <!-- Statistics details will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div class="modal fade" id="comparisonModal" tabindex="-1" role="dialog" aria-labelledby="comparisonModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="comparisonModalLabel">Comparaison des Matériaux</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-12">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div id="comparisonTable" class="table-responsive">
                                <!-- Comparison table will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>












    


   <!-- Team Start -->
<div id="team" class="container-xxl py-5">
    <div class="container">
        <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 600px;">
            <p class="d-inline-block border rounded-pill py-1 px-4">Team</p>
            <h1>Our Team</h1>
        </div>
        <div class="row g-4 justify-content-center">
            <div class="col-lg-3 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                <div class="team-item position-relative rounded overflow-hidden">
                    <div class="overflow-hidden">
                        <img class="img-fluid" src="img/team-2.jpg" alt="Amani Barhoumi">
                    </div>
                    <div class="team-text bg-light text-center p-4">
                        <h5>Amani Barhoumi</h5>
                        <p class="text-primary">Civil Engineering Department</p>
                        <div class="team-social text-center">
                            <a class="btn btn-square" href="https://www.linkedin.com/in/amani-barhoumi-7a8388332/" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                            <a class="btn btn-square" href="https://github.com/amani-brh" target="_blank"><i class="fab fa-github"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Team End -->
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let currentMaterialId = null;
        let emissionsChart = null;
        let pollutionChart = null;
        let comparisonChart = null;
        let selectedMaterials = [];

        // Load all materials when page loads
        $(document).ready(function() {
            loadMaterials();

            // Set up search button click event
            $("#searchButton").click(function() {
                const searchTerm = $("#searchInput").val();
                searchMaterials(searchTerm);
            });

            // Allow search on Enter key
            $("#searchInput").keypress(function(e) {
                if (e.which === 13) {
                    const searchTerm = $(this).val();
                    searchMaterials(searchTerm);
                }
            });

            // Set up view stats button click event
            $("#viewStatsBtn").click(function() {
                if (currentMaterialId) {
                    loadMaterialStats(currentMaterialId);
                    $("#materialModal").modal('hide');
                    $("#statsModal").modal('show');
                }
            });

            // Set up compare button click event
            $("#compareButton").click(function() {
                if (selectedMaterials.length > 1) {
                    compareMaterials(selectedMaterials);
                } else {
                    alert("Veuillez sélectionner au moins 2 matériaux pour la comparaison.");
                }
            });

            // Select all checkbox
            $("#selectAll").change(function() {
                const isChecked = $(this).prop('checked');
                $(".material-select").prop('checked', isChecked);
                updateSelectedMaterials();
            });
        });

        // Function to load all materials
        function loadMaterials() {
            $.ajax({
                url: '/Materiaux/List',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    displayMaterials(data);
                },
                error: function(xhr, status, error) {
                    console.error('Error loading materials:', error);
                    alert('Erreur lors du chargement des matériaux.');
                }
            });
        }

        // Function to search materials by name
        function searchMaterials(searchTerm) {
            $.ajax({
                url: '/Materiaux/Search',
                type: 'GET',
                data: { name: searchTerm },
                dataType: 'json',
                success: function(data) {
                    displayMaterials(data);
                },
                error: function(xhr, status, error) {
                    console.error('Error searching materials:', error);
                    alert('Erreur lors de la recherche des matériaux.');
                }
            });
        }

        // Function to display materials in the table
        function displayMaterials(materials) {
            const tbody = $("#materialsTable tbody");
            tbody.empty();

            if (materials.length === 0) {
                tbody.append('<tr><td colspan="8" class="text-center">Aucun matériau trouvé</td></tr>');
                return;
            }

            materials.forEach(function(material) {
                const row = `<tr>
                    <td><input type="checkbox" class="material-select" data-id="${material.idMateriau}" data-name="${material.nom}" /></td>
                    <td>${material.nom}</td>
                    <td>${material.origine}</td>
                    <td>${material.familleNom}</td>
                    <td>${material.typeNom}</td>
                    <td>${material.provenance ? material.provenance.pays : 'N/A'}</td>
                    <td>${material.emissionCO2Totale.toFixed(2)} kg CO2</td>
                    <td>
                        <button class="btn btn-info btn-sm view-details" data-id="${material.idMateriau}">Détails</button>
                        <button class="btn btn-success btn-sm view-stats" data-id="${material.idMateriau}">Statistiques</button>
                    </td>
                </tr>`;
                tbody.append(row);
            });

            // Add click event for detail buttons
            $(".view-details").click(function() {
                const materialId = $(this).data('id');
                loadMaterialDetails(materialId);
            });

            // Add click event for stats buttons
            $(".view-stats").click(function() {
                const materialId = $(this).data('id');
                loadMaterialStats(materialId);
            });

            // Add click event for checkboxes
            $(".material-select").change(function() {
                updateSelectedMaterials();
            });
        }

        // Function to update selected materials
        function updateSelectedMaterials() {
            selectedMaterials = [];
            $(".material-select:checked").each(function() {
                selectedMaterials.push({
                    id: $(this).data('id'),
                    name: $(this).data('name')
                });
            });

            // Enable or disable compare button
            if (selectedMaterials.length > 1) {
                $("#compareButton").prop('disabled', false);
            } else {
                $("#compareButton").prop('disabled', true);
            }
        }

        // Function to load material details
        function loadMaterialDetails(id) {
            $.ajax({
                url: `/Materiaux/Details/${id}`,
                type: 'GET',
                dataType: 'json',
                success: function(material) {
                    currentMaterialId = material.idMateriau;
                    displayMaterialDetails(material);
                    $("#materialModal").modal('show');
                },
                error: function(xhr, status, error) {
                    console.error('Error loading material details:', error);
                    alert('Erreur lors du chargement des détails du matériau.');
                }
            });
        }

        // Function to display material details in the modal
        function displayMaterialDetails(material) {
            $("#materialModalLabel").text(`Détails: ${material.nom}`);

            let transportHTML = '';
            if (material.transports && material.transports.length > 0) {
                transportHTML = `
                <h5 class="mt-3">Transports</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Moyen</th>
                            <th>Distance (km)</th>
                            <th>Émission CO2 (kg)</th>
                        </tr>
                    </thead>
                    <tbody>`;

                material.transports.forEach(function(transport) {
                    transportHTML += `
                        <tr>
                            <td>${transport.moyenTransportNom}</td>
                            <td>${transport.distanceKm}</td>
                            <td>${transport.emissionCO2.toFixed(2)}</td>
                        </tr>`;
                });

                transportHTML += `
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold">
                            <td>Total</td>
                            <td>${material.distanceTotale} km</td>
                            <td>${material.transports.reduce((sum, t) => sum + t.emissionCO2, 0).toFixed(2)} kg CO2</td>
                        </tr>
                    </tfoot>
                </table>`;
            } else {
                transportHTML = '<p>Aucune information de transport disponible.</p>';
            }

            const caractHTML = material.caracteristiques ?
                `<div class="row">
                    <div class="col-md-6">
                        <p><strong>Émission CO2:</strong> ${material.caracteristiques.emissionCO2.toFixed(2)} kg</p>
                        <p><strong>Pollution Eau:</strong> ${material.caracteristiques.pollutionEau.toFixed(2)}</p>
                        <p><strong>Pollution Air:</strong> ${material.caracteristiques.pollutionAir.toFixed(2)}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Consommation Eau:</strong> ${material.caracteristiques.consommationEau.toFixed(2)} m³</p>
                        <p><strong>Unité Fonctionnelle:</strong> ${material.caracteristiques.uniteFonctionnelle}</p>
                        <p><strong>Utilisation Eau Douce:</strong> ${material.caracteristiques.utilisationNetteEauDouce}</p>
                    </div>
                </div>` :
                '<p>Aucune caractéristique environnementale disponible.</p>';

            const detailsHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h5>Informations générales</h5>
                        <p><strong>ID:</strong> ${material.idMateriau}</p>
                        <p><strong>Nom:</strong> ${material.nom}</p>
                        <p><strong>Origine:</strong> ${material.origine}</p>
                        <p><strong>Famille:</strong> ${material.familleNom}</p>
                        <p><strong>Type:</strong> ${material.typeNom}</p>
                    </div>
                    <div class="col-md-6">
                        <h5>Provenance</h5>
                        <p><strong>Pays:</strong> ${material.provenance ? material.provenance.pays : 'N/A'}</p>
                        <p><strong>Région:</strong> ${material.provenance ? material.provenance.region : 'N/A'}</p>
                        <p><strong>Distance:</strong> ${material.provenance ? material.provenance.distanceKm : 'N/A'} km</p>

                        <h5 class="mt-3">Producteur</h5>
                        <p><strong>Nom:</strong> ${material.producteur ? material.producteur.nom : 'N/A'}</p>
                        <p><strong>Lieu de production:</strong> ${material.producteur ? material.producteur.lieuProduction : 'N/A'}</p>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Caractéristiques environnementales</h5>
                        ${caractHTML}
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        ${transportHTML}
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <h5>Bilan CO2</h5>
                            <p><strong>Production:</strong> ${(material.caracteristiques?.emissionCO2 || 0).toFixed(2)} kg CO2</p>
                            <p><strong>Transport:</strong> ${material.transports.reduce((sum, t) => sum + t.emissionCO2, 0).toFixed(2)} kg CO2</p>
                            <p><strong>Total:</strong> ${material.emissionCO2Totale.toFixed(2)} kg CO2</p>
                        </div>
                    </div>
                </div>`;

            $("#materialModalBody").html(detailsHTML);
        }

        // Function to load material statistics
        function loadMaterialStats(id) {
            $.ajax({
                url: `/Materiaux/Details/${id}`,
                type: 'GET',
                dataType: 'json',
                success: function(material) {
                    $.ajax({
                        url: `/Materiaux/Statistics/${id}`,
                        type: 'GET',
                        dataType: 'json',
                        success: function(stats) {
                            $("#statsModalLabel").text(`Statistiques: ${material.nom}`);
                            displayStatistics(stats, material);
                        },
                        error: function(xhr, status, error) {
                            console.error('Error loading statistics:', error);
                            alert('Erreur lors du chargement des statistiques.');
                        }
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error loading material for stats:', error);
                    alert('Erreur lors du chargement du matériau.');
                }
            });
        }

        // Function to display statistics in the modal
        function displayStatistics(stats, material) {
            // Create statistics details HTML
            const statsHTML = `
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="thead-light">
                        <tr>
                            <th>Métrique</th>
                            <th>Valeur</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Émission CO2 Production</td>
                            <td>${stats.EmissionCO2Production.toFixed(2)} kg CO2</td>
                        </tr>
                        <tr>
                            <td>Émission CO2 Transport</td>
                            <td>${stats.EmissionCO2Transport.toFixed(2)} kg CO2</td>
                        </tr>
                        <tr>
                            <td>Émission CO2 Totale</td>
                            <td>${stats.EmissionCO2Totale.toFixed(2)} kg CO2</td>
                        </tr>
                        <tr>
                            <td>Pollution de l'Eau</td>
                            <td>${stats.PollutionEau.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td>Pollution de l'Air</td>
                            <td>${stats.PollutionAir.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td>Consommation d'Eau</td>
                            <td>${stats.ConsommationEau.toFixed(2)} m³</td>
                        </tr>
                        <tr>
                            <td>Distance Totale</td>
                            <td>${stats.DistanceTotale.toFixed(0)} km</td>
                        </tr>
                    </tbody>
                </table>
            </div>`;

            $("#statsDetails").html(statsHTML);

            // Create emissions chart
            if (emissionsChart) {
                emissionsChart.destroy();
            }

            const emissionsCtx = document.getElementById('emissionsChart').getContext('2d');
            emissionsChart = new Chart(emissionsCtx, {
                type: 'pie',
                data: {
                    labels: ['Production', 'Transport'],
                    datasets: [{
                        label: 'Émissions CO2 (kg)',
                        data: [
                            stats.EmissionCO2Production,
                            stats.EmissionCO2Transport
                        ],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        title: {
                            display: true,
                            text: 'Répartition des Émissions CO2'
                        }
                    }
                }
            });

            // Create pollution chart
            if (pollutionChart) {
                pollutionChart.destroy();
            }

            const pollutionCtx = document.getElementById('pollutionChart').getContext('2d');
            pollutionChart = new Chart(pollutionCtx, {
                type: 'bar',
                data: {
                    labels: ['Pollution Air', 'Pollution Eau', 'Consommation Eau (m³)'],
                    datasets: [{
                        label: 'Impact Environnemental',
                        data: [
                            stats.PollutionAir,
                            stats.PollutionEau,
                            stats.ConsommationEau
                        ],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Impact Environnemental'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Function to compare materials
        function compareMaterials(materials) {
            const ids = materials.map(m => m.id).join(',');

            $.ajax({
                url: `/Materiaux/Compare?ids=${ids}`,
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    displayComparison(data);
                    $("#comparisonModal").modal('show');
                },
                error: function(xhr, status, error) {
                    console.error('Error comparing materials:', error);
                    alert('Erreur lors de la comparaison des matériaux.');
                }
            });
        }

        // Function to display comparison
        function displayComparison(comparisonData) {
            $("#comparisonModalLabel").text(`Comparaison: ${selectedMaterials.map(m => m.name).join(' vs ')}`);

            // Create comparison table
            let tableHTML = `
            <table class="table table-bordered table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Métrique</th>`;

            comparisonData.forEach(item => {
                tableHTML += `<th>${item.material.nom}</th>`;
            });

            tableHTML += `
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Émission CO2 Production (kg)</td>`;

            comparisonData.forEach(item => {
                tableHTML += `<td>${item.statistics.EmissionCO2Production.toFixed(2)}</td>`;
            });

            tableHTML += `
                    </tr>
                    <tr>
                        <td>Émission CO2 Transport (kg)</td>`;

            comparisonData.forEach(item => {
                tableHTML += `<td>${item.statistics.EmissionCO2Transport.toFixed(2)}</td>`;
            });

            tableHTML += `
                    </tr>
                    <tr>
                        <td>Émission CO2 Totale (kg)</td>`;

            comparisonData.forEach(item => {
                tableHTML += `<td>${item.statistics.EmissionCO2Totale.toFixed(2)}</td>`;
            });

            tableHTML += `
                    </tr>
                    <tr>
                        <td>Pollution de l'Eau</td>`;

            comparisonData.forEach(item => {
                tableHTML += `<td>${item.statistics.PollutionEau.toFixed(2)}</td>`;
            });

            tableHTML += `
                    </tr>
                    <tr>
                        <td>Pollution de l'Air</td>`;

            comparisonData.forEach(item => {
                tableHTML += `<td>${item.statistics.PollutionAir.toFixed(2)}</td>`;
            });

            tableHTML += `
                    </tr>
                    <tr>
                        <td>Consommation d'Eau (m³)</td>`;

            comparisonData.forEach(item => {
                tableHTML += `<td>${item.statistics.ConsommationEau.toFixed(2)}</td>`;
            });

            tableHTML += `
                    </tr>
                    <tr>
                        <td>Distance Totale (km)</td>`;

            comparisonData.forEach(item => {
                tableHTML += `<td>${item.statistics.DistanceTotale.toFixed(0)}</td>`;
            });

            tableHTML += `
                    </tr>
                </tbody>
            </table>`;

            $("#comparisonTable").html(tableHTML);

            // Create comparison chart
            if (comparisonChart) {
                comparisonChart.destroy();
            }

            const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');

            // Get all material names for labels
            const materialNames = comparisonData.map(item => item.material.nom);

            // Get CO2 emission data for each material
            const productionData = comparisonData.map(item => item.statistics.EmissionCO2Production);
            const transportData = comparisonData.map(item => item.statistics.EmissionCO2Transport);

            comparisonChart = new Chart(comparisonCtx, {
                type: 'bar',
                data: {
                    labels: materialNames,
                    datasets: [
                        {
                            label: 'CO2 Production (kg)',
                            data: productionData,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'CO2 Transport (kg)',
                            data: transportData,
                            backgroundColor: 'rgba(255, 99, 132, 0.7)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Comparaison des Émissions CO2'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'kg CO2'
                            }
                        }
                    }
                }
            });
        }
    </script>
}